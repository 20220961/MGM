{{> layouts/header}}

<h1 id="diaryTitle">{{diary.title}}</h1>
<p id="diaryAuthor">작성자: <a href="/user/{{diary.user.id}}/guestbook">{{diary.user.nickname}}</a></p>
<p id="diaryContent">{{diary.content}}</p>
<div id="diaryImages">
    {{#diary.pictureBase64List}}
        <img src="data:image/jpeg;base64,{{.}}" alt="Diary Image">
    {{/diary.pictureBase64List}}
</div>
<p id="diaryRegdate">작성 시간: {{diary.regdate}}</p>

<button id="editDiary">수정</button>
<button id="deleteDiary">삭제</button>

<form id="editDiaryForm" style="display:none;">
    <input type="text" id="editDiaryTitle" value="{{diary.title}}" required>
    <textarea id="editDiaryContent" required>{{diary.content}}</textarea>
    <input type="file" id="editDiaryImages" multiple>
    <button type="submit">수정 완료</button>
</form>

{{> layouts/footer}}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var diaryId = {{diary.id}}; // 서버에서 전달된 diary ID를 사용

        // 게시글 수정 버튼 클릭 이벤트
        document.getElementById('editDiary').addEventListener('click', function() {
            document.getElementById('editDiaryForm').style.display = 'block';
        });

        // 게시글 수정 폼 제출 이벤트
        document.getElementById('editDiaryForm').addEventListener('submit', function(event) {
            event.preventDefault();

            var formData = new FormData();
            formData.append('title', document.getElementById('editDiaryTitle').value);
            formData.append('content', document.getElementById('editDiaryContent').value);
            var images = document.getElementById('editDiaryImages').files;
            for (var i = 0; i < images.length; i++) {
                formData.append('pictures', images[i]);
            }

            fetch('/api/diaries/' + diaryId + '/update', {
                method: 'PUT',
                body: formData
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                window.location.reload(); // 수정 후 페이지 새로고침
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        // 게시글 삭제 버튼 클릭 이벤트
        document.getElementById('deleteDiary').addEventListener('click', function() {
            if (confirm('이 게시글을 삭제하시겠습니까?')) {
                fetch('/api/diaries/' + diaryId + '/delete', {
                    method: 'PUT'
                })
                .then(response => response.text())
                .then(result => {
                    alert(result);
                    window.location.href = '/diaries'; // 삭제 후 리스트 페이지로 이동
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        });
    });
</script>
